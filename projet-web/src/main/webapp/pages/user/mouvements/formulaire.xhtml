<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition template="/template/page-standard.xhtml">

    <!-- ‚ö° Initialisation avant rendu -->
    <f:metadata>
        <!-- 1Ô∏è Mettre le compte actif dans modelCompte -->
        <f:viewAction action="#{modelCompte.setCourant(compteActif)}" />

        <!-- 2Ô∏è Cr√©er et associer un mouvement avec ce compte -->
        <f:viewAction action="#{modelMouvement.initialiserMouvement(modelCompte.courant)}" />

        <!-- 3Ô∏è Si id en param√®tre ‚Üí charger le mouvement existant -->
        <f:viewParam name="id" value="#{modelMouvement.courant.id}" />
        <f:viewAction action="#{modelMouvement.actualiserCourant()}" />
    </f:metadata>

    <!-- üè∑Ô∏è Titre dynamique s√©curis√© -->
    <ui:define name="titre">
        #{empty modelMouvement.courant or empty modelMouvement.courant.id 
            ? 'Nouveau mouvement' 
            : 'Modifier le mouvement'}
    </ui:define>

    <ui:define name="contenu">

        <h2>
            #{empty modelMouvement.courant or empty modelMouvement.courant.id 
                ? 'Cr√©er un nouveau mouvement financier' 
                : 'Modifier le mouvement financier'}
        </h2>

        <div class="form-help">
            <p>
                Un mouvement financier repr√©sente une transaction li√©e √† votre compte bancaire.
                Renseignez la date, le libell√© descriptif et le montant de la transaction.
            </p>
        </div>

        <br />

        <h:form styleClass="form-container">
            <fieldset class="form-fieldset">
                <legend>Informations du mouvement</legend>

                <table class="form">

                    <!-- ID (readonly) -->
                    <tr rendered="#{not empty modelMouvement.courant.id}">
                        <td class="form-label">
                            <h:outputLabel for="id" value="Identifiant :" />
                        </td>
                        <td class="form-input">
                            <h:inputText id="id"
                                         value="#{modelMouvement.courant.id}"
                                         size="10"
                                         readonly="true"
                                         styleClass="readonly-input" />
                            <br />
                            <h:message for="id" errorClass="error" />
                        </td>
                    </tr>

                    <!-- Date -->
                    <tr>
                        <td class="form-label">
                            <h:outputLabel for="date" value="Date du mouvement :" styleClass="required-field" />
                        </td>
                        <td class="form-input">
                            <h:inputText id="date"
                                         value="#{modelMouvement.courant.date}"
                                         type="date"
                                         required="true"
                                         requiredMessage="La date du mouvement est obligatoire"
                                         styleClass="date-input">
                                <f:convertDateTime pattern="yyyy-MM-dd" type="localDate" />
                            </h:inputText>
                            <br />
                            <span class="field-hint">S√©lectionnez la date √† laquelle le mouvement a eu lieu</span>
                            <br />
                            <h:message for="date" errorClass="error" />
                        </td>
                    </tr>

                    <!-- Libell√© -->
                    <tr>
                        <td class="form-label">
                            <h:outputLabel for="libelle" value="Libell√© :" styleClass="required-field" />
                        </td>
                        <td class="form-input">
                            <h:inputText id="libelle"
                                         value="#{modelMouvement.courant.libelle}"
                                         size="50"
                                         maxlength="50"
                                         required="true"
                                         requiredMessage="Le libell√© du mouvement est obligatoire"
                                         styleClass="text-input"
                                         placeholder="Ex: Paiement facture √©lectricit√©, Virement salaire..." />
                            <br />
                            <span class="field-hint">Description du mouvement (max 50 caract√®res)</span>
                            <br />
                            <h:message for="libelle" errorClass="error" />
                        </td>
                    </tr>

                    <!-- Montant -->
                    <tr>
                        <td class="form-label">
                            <h:outputLabel for="montant" value="Montant (‚Ç¨) :" styleClass="required-field" />
                        </td>
                        <td class="form-input">
                            <h:inputText id="montant"
                                         value="#{modelMouvement.courant.montant}"
                                         size="15"
                                         required="true"
                                         requiredMessage="Le montant du mouvement est obligatoire"
                                         styleClass="number-input">
                                <f:convertNumber type="currency" currencySymbol="" minFractionDigits="2" maxFractionDigits="2" />
                            </h:inputText>
                            <br />
                            <span class="field-hint">Montant en euros (ex: 150.75)</span>
                            <br />
                            <h:message for="montant" errorClass="error" />
                        </td>
                    </tr>
                </table>
            </fieldset>

            <br />

            <!-- Boutons d'action -->
            <div class="form-actions">
                <h:commandButton action="#{modelMouvement.validerMiseAJour()}"
                                 value="#{empty modelMouvement.courant.id ? 'Cr√©er le mouvement' : 'Enregistrer les modifications'}"
                                 styleClass="btn btn-primary btn-large" />

                <h:button outcome="liste"
                          value="Annuler"
                          styleClass="btn btn-secondary btn-large" />
            </div>

            <br />

            <div class="context-help">
                <h4>Aide</h4>
                <ul>
                    <li><strong>Date :</strong> Indiquez la date r√©elle de la transaction</li>
                    <li><strong>Libell√© :</strong> D√©crivez clairement la nature du mouvement</li>
                    <li><strong>Montant :</strong> Montant positif (les d√©bits/cr√©dits sont g√©r√©s ailleurs)</li>
                </ul>
            </div>
        </h:form>

    </ui:define>

</ui:composition>
</html>
