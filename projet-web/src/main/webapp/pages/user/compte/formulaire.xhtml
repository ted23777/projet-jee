<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition template="/template/page-standard.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">

    <!--
        Ici on initialise modelCompte.courant avec compteActif directement.
        Pas besoin de paramètre d'URL ni de bean supplémentaire.
    -->
    <f:metadata>
        <f:viewAction action="#{modelCompte.setCourant(compteActif)}" />
    </f:metadata>

    <ui:define name="titre">Compte</ui:define>

    <ui:define name="contenu">

        <!-- ✅ Si connecté -->
        <h:panelGroup rendered="#{compteActif.loggedIn}">
            <h:form>
                <table class="form"> 
                    <tr>
                        <td><h:outputLabel for="nom" value="Nom :" /></td>
                        <td>
                            <h:inputText id="nom" size="25"
                                         value="#{modelCompte.courant.nom}" />
                            <h:message for="nom" errorClass="error" />
                        </td>
                    </tr>

                    <tr>
                        <td><h:outputLabel for="prenom" value="Prénom :" /></td>
                        <td>
                            <h:inputText id="prenom" size="25"
                                         value="#{modelCompte.courant.prenom}" />
                            <h:message for="prenom" errorClass="error" />
                        </td>
                    </tr>

                    <tr>
                        <td><h:outputLabel for="email" value="Email :" /></td>
                        <td>
                            <h:inputText id="email" size="50"
                                         value="#{modelCompte.courant.adresseMail}" />
                            <h:message for="email" errorClass="error" />
                        </td>
                    </tr>

                    <tr>
                        <td><h:outputLabel for="motDePasse" value="Mot de passe :" /></td>
                        <td>
                            <h:inputText id="motDePasse" size="25"
                                         value="#{modelCompte.courant.motDePasse}" />
                            <h:message for="motDePasse" errorClass="error" />
                        </td>
                    </tr>
                </table>

                <br />
                <h:commandButton value="Valider"
                                 action="#{modelCompte.validerMiseAJour()}" outcome="home" />
                <h:button value="Retour" outcome="home" />
            </h:form>
        </h:panelGroup>

        <!-- ❌ Si NON connecté -->
        <h:panelGroup rendered="#{not compteActif.loggedIn}">
            <h:outputText value="Vous devez être connecté pour accéder à cette page." />
            <br />
            <h:link outcome="connexion" value="Aller à la page de connexion" />
        </h:panelGroup>

    </ui:define>
</ui:composition>
