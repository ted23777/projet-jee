<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition template="/template/page-standard.xhtml">
    <ui:define name="titre">
        #{modelEntretien.courant.id == null ? 'Nouvel Entretien' : 'Modifier l\'Entretien'}
    </ui:define>
    <ui:define name="contenu">
        <h2>#{modelEntretien.courant.id == null ? 'â• Planifier un nouvel entretien' : 'âœï¸ Modifier l\'entretien'}</h2>

        <div class="form-intro">
            <p>
                #{modelEntretien.courant.id == null ?
                    'ğŸ“‹ Remplissez le formulaire ci-dessous pour planifier une nouvelle tÃ¢che d\'entretien pour vos cultures.' :
                    'ğŸ“ Modifiez les informations de l\'entretien ci-dessous.'}
            </p>
        </div>

        <h:form styleClass="form-entretien">
            <fieldset class="form-section">
                <legend>ğŸ“… Informations de base</legend>

                <table class="form">
                    <!-- ID (lecture seule) -->
                    <tr rendered="#{modelEntretien.courant.id != null}">
                        <td class="label-column">
                            <h:outputLabel for="id">ğŸ”¢ Identifiant :</h:outputLabel>
                        </td>
                        <td>
                            <h:inputText id="id"
                                         size="10"
                                         readonly="true"
                                         value="#{modelEntretien.courant.id}"
                                         styleClass="readonly-field" />
                            <br />
                            <h:message for="id" errorClass="error" />
                        </td>
                    </tr>

                    <!-- Date de l'entretien -->
                    <tr>
                        <td class="label-column">
                            <h:outputLabel for="date">ğŸ“… Date de l'entretien * :</h:outputLabel>
                        </td>
                        <td>
                            <h:inputText id="date"
                                         value="#{modelEntretien.courant.date}"
                                         type="date"
                                         required="true"
                                         requiredMessage="La date de l'entretien est obligatoire"
                                         styleClass="date-input">
                                <f:convertDateTime pattern="yyyy-MM-dd" type="localDate" />
                            </h:inputText>
                            <br />
                            <span class="field-hint">ğŸ’¡ SÃ©lectionnez la date Ã  laquelle l'entretien doit Ãªtre effectuÃ©</span>
                            <br />
                            <h:message for="date" errorClass="error" />
                        </td>
                    </tr>

                    <!-- Titre de l'entretien -->
                    <tr>
                        <td class="label-column">
                            <h:outputLabel for="titre">ğŸ·ï¸ Titre de l'entretien * :</h:outputLabel>
                        </td>
                        <td>
                            <h:inputText id="titre"
                                         size="50"
                                         maxlength="50"
                                         value="#{modelEntretien.courant.titre}"
                                         required="true"
                                         requiredMessage="Le titre de l'entretien est obligatoire"
                                         styleClass="text-input" />
                            <br />
                            <span class="field-hint">ğŸ’¡ DÃ©crivez briÃ¨vement le type d'entretien (ex: Arrosage, DÃ©sherbage, Fertilisation, Taille...)</span>
                            <br />
                            <h:message for="titre" errorClass="error" />
                        </td>
                    </tr>
                </table>
            </fieldset>

            <br />

            <!-- Section des cultures concernÃ©es -->
            <fieldset class="form-section">
                <legend>ğŸŒ± Cultures concernÃ©es par cet entretien</legend>

                <p class="section-description">
                    SÃ©lectionnez une ou plusieurs cultures qui nÃ©cessitent cet entretien.
                    Vous pouvez sÃ©lectionner plusieurs cultures en maintenant la touche Ctrl (Windows) ou Cmd (Mac).
                </p>

                <h:panelGroup rendered="#{empty modelEntretien.culturesDisponibles}">
                    <div class="warning-message">
                        <strong>âš ï¸ Aucune culture disponible</strong>
                        <p>Vous devez d'abord crÃ©er des cultures avant de pouvoir les associer Ã  un entretien.</p>
                        <h:button value="â• CrÃ©er une culture"
                                  outcome="/pages/admin/cultures/formulaire"
                                  styleClass="btn btn-primary" />
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{not empty modelEntretien.culturesDisponibles}">
                    <h:selectManyListbox id="cultures"
                                         value="#{modelEntretien.culturesConcerneesIds}"
                                         size="10"
                                         styleClass="cultures-select">
                        <f:selectItems value="#{modelEntretien.culturesDisponibles}"
                                       var="culture"
                                       itemValue="#{culture.id}"
                                       itemLabel="#{culture.nom}" />
                    </h:selectManyListbox>
                    <br />
                    <span class="field-hint">
                        ğŸ’¡ Astuce : maintenez Ctrl (ou Cmd) pour sÃ©lectionner plusieurs cultures
                    </span>
                    <br />
                    <h:message for="cultures" errorClass="error" />
                </h:panelGroup>
            </fieldset>

            <br />

            <!-- Boutons d'action -->
            <div class="form-actions">
                <h:commandButton action="#{modelEntretien.validerMiseAJour}"
                                 value="#{modelEntretien.courant.id == null ? 'âœ… CrÃ©er l\'entretien' : 'ğŸ’¾ Enregistrer les modifications'}"
                                 styleClass="btn btn-success btn-large" />

                <h:button outcome="liste"
                          value="âŒ Annuler"
                          styleClass="btn btn-secondary btn-large" />
            </div>

            <div class="form-footer">
                <p class="required-note">* Champs obligatoires</p>
            </div>
        </h:form>

        <!-- Aide contextuelle -->
        <div class="help-section">
            <h3>â“ Aide</h3>
            <ul>
                <li><strong>Date</strong> : Indiquez la date prÃ©vue pour effectuer cet entretien</li>
                <li><strong>Titre</strong> : Donnez un nom explicite Ã  l'entretien (maximum 50 caractÃ¨res)</li>
                <li><strong>Cultures</strong> : SÃ©lectionnez toutes les cultures qui nÃ©cessitent ce type d'entretien Ã  cette date</li>
                <li><strong>Modification</strong> : Vous pouvez modifier les cultures associÃ©es Ã  tout moment</li>
                <li><strong>Suppression</strong> : Pour supprimer un entretien, retournez Ã  la liste des entretiens</li>
            </ul>
        </div>
    </ui:define>

    <f:metadata>
        <f:viewParam name="id" value="#{modelEntretien.courant.id}" />
        <f:viewAction action="#{modelEntretien.actualiserCourant}" />
    </f:metadata>
</ui:composition>
</html>