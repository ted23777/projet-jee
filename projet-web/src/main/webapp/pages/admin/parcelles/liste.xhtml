<?xml version='1.0' encoding='UTF-8'?> 
<ui:composition template="/template/page-standard.xhtml"
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets">

    <f:metadata>
        <f:viewParam name="idParcelle" value="#{modelParcelle.courant.id}" />
        <f:viewAction action="#{modelParcelle.actualiserCourant()}" />
    </f:metadata>

    <ui:define name="titre">Gestion des Parcelles</ui:define>

    <ui:define name="contenu">
        <h2>Liste des Parcelles</h2>
        
        <h:form>
            <!-- Affichage si aucune parcelle -->
            <h:panelGroup rendered="#{empty modelParcelle.liste}">
                <h4>Aucune parcelle trouvée.</h4>
            </h:panelGroup>

            <!-- Tableau des Parcelles -->
            <h:dataTable value="#{modelParcelle.liste}" var="item" rendered="#{not empty modelParcelle.liste}">
                <h:column>
                    <f:facet name="header">ID</f:facet>
                    #{item.id}
                </h:column>

<h:column>
    <f:facet name="header">
        <h:outputText value="Propriétaire" />
    </f:facet>
    <h:outputText value="#{modelParcelle.getNomProprietaire(item.idCompte)}" />
</h:column>

                <h:column>
                    <f:facet name="header">Surface (m²)</f:facet>
                    <h:outputText value="#{item.surface}" />
                </h:column>

                <h:column>
                    <f:facet name="header">Statut</f:facet>
                    <h:outputText value="#{item.libre ? 'Libre' : 'Occupée'}" />
                </h:column>

                <h:column>
                    <f:facet name="header">Actions</f:facet>

                    <!-- Bouton Modifier -->
                    <h:link outcome="formulaire">
                        <f:param name="id" value="#{item.id}" />
                        Modifier
                    </h:link>

                    <!-- Bouton Supprimer -->
                    <h:commandButton action="#{modelParcelle.supprimer(item)}"
                                     onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette parcelle ?')"
                                     value="Supprimer" />
                </h:column>
                
                <h:column>
    <f:facet name="header">
        <h:outputText value="Surface restante (m²)" />
    </f:facet>
    <h:outputText value="#{modelParcelle.getSurfaceRestante(item)}">
        <f:convertNumber type="number" maxFractionDigits="2" />
    </h:outputText>
</h:column>
            </h:dataTable>

            <br />

            <!-- Boutons d'action -->
            <h:commandButton value="Ajouter une Parcelle" action="formulaire" />
            <h:button value="Retour à l'accueil" outcome="info" />
        </h:form>
    </ui:define>
</ui:composition>
